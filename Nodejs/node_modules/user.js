const express = require('express');
const router = express.Router();
const db = require('./db.js');
// Example user registration route
router.post('/vehicledata', (req, res) => {

  
  var receivedData = JSON.parse(JSON.stringify(req.body));

  var sqlQuery = "INSERT INTO user (id, battery_temp_unit,  load_unit, time, battery_temp, battery_perc, motor_temp, moto_unit, motor_curr, pressure, pressure_unit, load1, map_lati, map_logi) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";

  db.query(sqlQuery, [receivedData.id, receivedData.battery_temp_unit, receivedData.load_unit, receivedData.time, receivedData.battery_temp, receivedData.battery_perc, receivedData.motor_temp, receivedData.moto_unit, receivedData.motor_curr, receivedData.pressure, receivedData.pressure_unit, receivedData.load1, receivedData.map_lati, receivedData.map_logi], function (error, data, fields) {
    if (error) {
      res.status(500).json({ success: false, message: error });
    } else {
      res.status(200).json({ success: true, message: 'User registered successfully!' });
    }
  });
});

router.get('/:vehicle_id/vehicledata', (req, res) => {

  // Assuming your user ID column is named 'vehicle_id'
  const sqlQuery = "SELECT * FROM user WHERE id = ?";

  db.query(sqlQuery, [req.params.vehicle_id], function (error, data, fields) {
    if (error) {
      res.status(500).json({ success: false, message: error });
    } else {
      if (data.length > 0) {
        const user = data[0];
        res.status(200).json({ success: true, user: user,'connecttion_status':"connected" });
      } else {
        res.status(404).json({ success: false, message: 'Vehicle data not found' });
      }
    }
  });
});

router.get('/:vehicle_id/vehicledata/:fromdate/:todate', (req, res) => {

  // Assuming your user ID column is named 'vehicle_id'
  var sqlQuery = `SELECT * FROM user WHERE id = '${req.params.vehicle_id}' AND CAST(time AS date) = '${req.params.fromdate}' AND CAST(time AS date) <= '${req.params.todate}'`;
 
  db.query(sqlQuery, function (error, data, fields) {
    if (error) {
      res.status(500).json({ success: false, message: error });
    } else {
      if (data.length > 0) {
       // const user = data[0];
        res.status(200).json({ success: true, user: data});
      } else {
        res.status(404).json({ success: false, message: 'Vehicle data not found' });
      }
    }
  });
});

module.exports = router;